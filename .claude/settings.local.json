{
  "permissions": {
    "allow": [
      "Bash(mvn compile -q 2>&1 | tail -30)",
      "Bash(mvn test -o 2>&1)",
      "Bash(mvn test -s /dev/null 2>&1)",
      "Bash(mvn test -s /tmp/mvn-settings.xml 2>&1)",
      "Bash(mvn dependency:tree -s /tmp/mvn-settings.xml 2>&1 | grep -A2 \"webmvc-test\\\\|test-autoconfigure\")",
      "Bash(jar tf /Users/malinghan/.m2/repository/org/springframework/boot/spring-boot-test-autoconfigure/4.0.3/spring-boot-test-autoconfigure-4.0.3.jar | grep -i webmvc)",
      "Bash(jar tf /Users/malinghan/.m2/repository/org/springframework/boot/spring-boot-webmvc-test/4.0.3/spring-boot-webmvc-test-4.0.3.jar 2>/dev/null | grep -i webmvc | head -20)",
      "Bash(jar tf /Users/malinghan/.m2/repository/org/springframework/boot/spring-boot-test/4.0.3/spring-boot-test-4.0.3.jar | grep -i \"MockitoBean\\\\|MockBean\")",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nfix: 修复 Provider 服务注册失败问题\n\n1. 将 MarpcApplication 移至根包 com.malinghan.marpc，确保组件扫描覆盖所有子包\n2. 使用 AopUtils.getTargetClass\\(\\) 获取真实实现类，兼容 CGLIB 代理\n3. 通过 ContextRefreshedEvent 延迟启动，确保所有 Bean 注册完成后再扫描\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "mcp__ide__getDiagnostics",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nfeat: v2.0 方法重载、类型转换、注册中心、负载均衡\n\n- RpcRequest 新增 methodSign 字段，格式 methodName@paramCount_type1_type2\n- Consumer 端自动生成方法签名，Provider 端按签名精确匹配方法，解决重载歧义\n- Provider 端 convertArgs 根据方法参数类型做 JSON 反序列化转换\n- 抽象 RegistryCenter 接口，实现 ZkRegistryCenter（Curator + Zookeeper 临时节点）\n- Provider 启动时注册服务，优雅关闭时注销\n- Consumer 订阅注册中心变更，实例上下线自动刷新服务列表\n- 抽象 LoadBalancer 接口，实现 RoundRobinLoadBalancer 和 RandomLoadBalancer\n- Consumer 通过 Supplier<String> 动态选取实例，支持热更新\n- 配置文件迁移至 application.yaml\n- 新增 ProviderBootstrapV2Test 覆盖重载、类型转换、负载均衡场景\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git tag v2.0 && git push origin master && git push origin v2.0)",
      "Bash(git add -A && git status)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nfeat: v3.0 多模块拆分、统一异常体系、规范 Bean 生命周期\n\n- 拆分为 4 个子模块：marpc-core / marpc-demo-api / marpc-demo-provider / marpc-demo-consumer\n- marpc-core：框架核心（协议、注解、Provider/Consumer 引导、注册中心、负载均衡、传输层）\n- marpc-demo-api：接口定义（HelloService / UserService / OrderService + User / Order 模型）\n- marpc-demo-provider：Spring Boot Provider 应用，实现所有接口\n- marpc-demo-consumer：Spring Boot Consumer 应用，4 个测试场景验证 RPC 功能\n  - Scene1：基本调用 & 方法重载\n  - Scene2：自定义对象 & 集合类型（User / Order）\n  - Scene3：异常透传\n  - Scene4：10 线程并发调用\n- 统一异常体系：MarpcException / MarpcBizException / MarpcFrameworkException / MarpcNetworkException\n- ProviderBootstrap 实现 InitializingBean + DisposableBean，替换 ContextRefreshedEvent\n- ConsumerBootstrap 实现 InitializingBean，生命周期由 Spring 统一管理\n- 新增 MarpcCoreV3Test 覆盖生命周期、异常体系、方法签名、类型转换、负载均衡\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git add marpc-core/src/main/java/com/malinghan/marpc/filter/ marpc-core/src/test/ marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/Scene5CacheFilter.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/Scene6MockFilter.java v4.0.md && git add marpc-core/pom.xml marpc-core/src/main/java/com/malinghan/marpc/config/MarpcConfig.java marpc-core/src/main/java/com/malinghan/marpc/consumer/ConsumerBootstrap.java marpc-core/src/main/java/com/malinghan/marpc/consumer/MarpcInvocationHandler.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/HelloConsumer.java marpc-demo-consumer/src/main/resources/application.yaml pom.xml && git status)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nfeat: v4.0 可插拔 Filter 链 & Testcontainers 测试隔离\n\n- 抽象 Filter 接口：preFilter（短路）/ postFilter（后置）/ order（排序）\n- 实现 CacheFilter：Consumer 端结果缓存，命中时跳过远程调用\n- 实现 MockFilter：按方法签名拦截请求返回预设值，用于测试\n- MarpcInvocationHandler 集成 Filter 链：preFilter 顺序执行，postFilter 逆序执行\n- ConsumerBootstrap 接收 List<Filter>，MarpcConfig 按配置开关组装 Filter 链\n- 配置项：marpc.filter.cache.enabled / marpc.filter.mock.enabled\n- 添加 Testcontainers 依赖，ZkRegistryCenterTest 不依赖本地 Zookeeper\n- FilterChainTest 覆盖缓存命中/miss、mock 拦截、短路逻辑、执行顺序\n- Demo 新增 Scene5（CacheFilter）和 Scene6（MockFilter）测试场景\n- 生成 v4.0.md\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" && git tag v4.0 && git push origin master && git push origin v4.0)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nfeat: v4.0 可插拔 Filter 链 & Testcontainers 测试隔离\n\n- Filter 接口：preFilter/postFilter，支持短路和后置处理\n- CacheFilter：Consumer 端结果缓存，命中时跳过远程调用\n- MockFilter：按方法签名拦截返回预设值，用于测试\n- Filter 链：按 order\\(\\) 排序，preFilter 顺序执行，postFilter 逆序执行\n- Testcontainers：ZkRegistryCenter 集成测试不依赖本地 Zookeeper\n- Scene5/6：演示缓存和 Mock 效果\n- FilterChainTest：单元测试验证 Filter 逻辑\n- ZkRegistryCenterTest：集成测试使用隔离容器\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git add marpc-core/src/main/java/com/malinghan/marpc/circuitbreaker/ marpc-core/src/main/java/com/malinghan/marpc/retry/ marpc-core/src/main/java/com/malinghan/marpc/router/ marpc-core/src/main/java/com/malinghan/marpc/config/MarpcConfig.java marpc-core/src/main/java/com/malinghan/marpc/consumer/ConsumerBootstrap.java marpc-core/src/main/java/com/malinghan/marpc/consumer/MarpcInvocationHandler.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/HelloConsumer.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/Scene7Retry.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/Scene8CircuitBreaker.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/Scene9GrayRouter.java marpc-demo-consumer/src/main/resources/application.yaml v5.0.md && git status)",
      "Bash(git tag v5.0 && git push origin master && git push origin v5.0)",
      "Bash(git tag -d v5.0 && git tag v5.0 && git push origin master && git push origin v5.0)",
      "Bash(find /Users/malinghan/project/xt/marpc -name \"pom.xml\" | xargs ls -la)",
      "Bash(mvn test -pl marpc-core 2>&1 | tail -40)",
      "Bash(mvn compile -q 2>&1 | tail -20)",
      "Bash(ls /Users/malinghan/project/xt/marpc/*.md)",
      "Bash(git add marpc-core/src/main/java/com/malinghan/marpc/context/ marpc-core/src/main/java/com/malinghan/marpc/transport/OkHttpTransport.java marpc-core/src/main/java/com/malinghan/marpc/transport/RpcTransport.java marpc-core/src/main/java/com/malinghan/marpc/transport/netty/ v6.0.md marpc-core/pom.xml marpc-core/src/main/java/com/malinghan/marpc/config/MarpcConfig.java marpc-core/src/main/java/com/malinghan/marpc/consumer/ConsumerBootstrap.java marpc-core/src/main/java/com/malinghan/marpc/consumer/MarpcInvocationHandler.java marpc-core/src/main/java/com/malinghan/marpc/core/RpcRequest.java marpc-core/src/main/java/com/malinghan/marpc/transport/MarpcTransport.java pom.xml)",
      "Bash(git commit -m \"$\\(cat <<'EOF'\nfeat: v6.0 RpcContext 隐式传参 & Netty 传输\n\n- 新增 RpcContext ThreadLocal 上下文容器，支持跨调用链透传参数\n- RpcRequest 新增 context 字段，Consumer 填充，Provider 读取\n- 抽象 RpcTransport 接口，支持 OkHttp 和 Netty 两种传输方式\n- 实现 Netty 自定义二进制协议（魔数 0xAA 0xBB + 版本 + 类型 + 序列号 + 长度 + JSON body）\n- NettyRpcClient 维护连接池，CompletableFuture 匹配异步响应\n- NettyRpcServer 独立监听端口（默认 9090），与 HTTP 端口并存\n- 配置项 marpc.transport 支持 okhttp/netty 切换\n- 新增 Netty 依赖（io.netty:netty-all:4.1.108.Final）\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git tag v6.0 && git push origin master && git push origin v6.0)",
      "Bash(cat /Users/malinghan/project/xt/marpc/marpc-demo-consumer/src/main/resources/application.yaml 2>/dev/null || find /Users/malinghan/project/xt/marpc/marpc-demo-consumer -name \"*.yaml\" -o -name \"*.yml\" | xargs ls)",
      "Bash(lsof -i :9090 2>/dev/null | head -5)",
      "Bash(mvn compile -q 2>&1 | tail -10)",
      "Bash(mvn compile -pl marpc-core -am -q 2>&1 && grep -n \"NODE_ADDED\\\\|忽略本次更新\" /Users/malinghan/project/xt/marpc/marpc-core/src/main/java/com/malinghan/marpc/registry/ZkRegistryCenter.java)",
      "Bash(git add marpc-core/src/main/java/com/malinghan/marpc/config/MarpcConfig.java marpc-core/src/main/java/com/malinghan/marpc/registry/ZkRegistryCenter.java marpc-core/src/main/java/com/malinghan/marpc/transport/netty/NettyClientHandler.java marpc-core/src/main/java/com/malinghan/marpc/transport/netty/NettyRpcClient.java marpc-core/src/main/java/com/malinghan/marpc/transport/netty/NettyServerHandler.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/HelloConsumer.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/Scene10RpcContext.java marpc-demo-consumer/src/main/java/com/malinghan/marpc/consumer/Scene11NettyTransport.java marpc-demo-consumer/src/main/resources/application.yaml marpc-demo-provider/src/main/java/com/malinghan/marpc/provider/HelloServiceImpl.java marpc-demo-provider/src/main/resources/application.yaml v6.0.md && git commit -m \"$\\(cat <<'EOF'\nfix: v6.0 Netty 传输层修复 & 测试场景完善\n\n核心修复：\n1. NettyRpcClient 端口替换：连接时用配置的 netty.port 替换注册中心的 HTTP 端口\n2. NettyRpcServer 条件装配：改为 marpc.netty.server.enabled 独立开关，避免 Consumer 侧启动服务端\n3. ZkRegistryCenter 订阅优化：过滤父节点自身的 NODE_ADDED 事件，避免初始化时实例列表被清空\n4. NettyRpcClient 连接管理：检查 channel.isActive\\(\\)，断开时自动重建\n5. 请求失败处理：writeAndFlush 失败时主动 complete future\n\n测试场景：\n- Scene10：RpcContext 隐式传参（单参数、多参数、ThreadLocal 清理）\n- Scene11：Netty 传输验证（基本调用、复杂对象、并发、与 RpcContext 联合）\n- HelloServiceImpl：新增 logContext，Provider 侧打印上下文参数\n- HelloConsumer：升级为 v6.0，注册 Scene10/11\n\n配置示例：\nProvider: marpc.transport=netty, marpc.netty.port=9090, marpc.netty.server.enabled=true\nConsumer: marpc.transport=netty, marpc.netty.port=9090\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git tag -d v6.0 && git push origin :refs/tags/v6.0 && git tag v6.0 && git push origin master && git push origin v6.0)"
    ]
  }
}
